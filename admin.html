<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin - FOKSI Absensi</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="card">
            <h2>Panel Admin FOKSI</h2>
            <p>Kelola Jadwal Absensi Kegiatan</p>
            
            <div style="text-align: left; margin-bottom: 20px;">
                <label>Tanggal Kegiatan</label>
                <input type="date" id="tglKegiatan">
                <label>Jam Mulai</label>
                <input type="time" id="jamMulai">
                <label>Jam Selesai</label>
                <input type="time" id="jamSelesai">
                <button id="btnBuatJadwal">Buat Jadwal Baru</button>
            </div>

            <hr style="margin: 20px 0;">
            <h3>Daftar Absensi Masuk</h3>
            <ul id="listAbsensi" style="list-style: none; text-align: left; margin-top: 10px;">
                </ul>

            <button onclick="logout()" class="secondary">Logout</button>
        </div>
    </div>

    <script type="module">
        import { auth, db } from './assets/js/firebase-config.js';
        import { signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Fungsi Buat Jadwal
        document.getElementById('btnBuatJadwal').addEventListener('click', async () => {
            const tgl = document.getElementById('tglKegiatan').value;
            const mulai = document.getElementById('jamMulai').value;
            const selesai = document.getElementById('jamSelesai').value;

            if(!tgl || !mulai || !selesai) return alert("Isi semua data!");

            try {
                await addDoc(collection(db, "jadwal"), {
                    tanggal: tgl,
                    jam_mulai: mulai,
                    jam_selesai: selesai,
                    status: true,
                    created_at: new Date()
                });
                alert("Jadwal Berhasil Dibuat!");
            } catch (e) {
                alert("Error: " + e.message);
            }
        });

        // Realtime Listener untuk melihat siapa yang absen
        const q = query(collection(db, "absensi"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('listAbsensi');
            list.innerHTML = "";
            snapshot.forEach((doc) => {
                const data = doc.data();
                list.innerHTML += `<li style="border-bottom:1px solid #eee; padding:5px;">
                    <b>${data.nama}</b> (${data.regional}) - <span class="status-${data.keterangan}">${data.keterangan}</span>
                </li>`;
            });
        });

        // Fungsi Logout (Global Scope)
        window.logout = () => {
            signOut(auth).then(() => window.location.href = "index.html");
        }
    </script>
</body>
</html>